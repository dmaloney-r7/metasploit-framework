#!/usr/bin/env ruby
# frozen_string_literal: true

# Copyright (C) 2008 Rapid7, Inc.

#
# This script extracts the forms from the main page of each
# web site in a list. The output of this can be used with
# Metasploit (and other tools) to obtain the saved form data
# of these domains.
#

require 'rubygems'  # install rubygems
require 'hpricot'   # gem install hpricot
require 'timeout'

def usage
  $stderr.puts "#{$PROGRAM_NAME} [site list] [output-dir]"
  exit(0)
end

input = ARGV.shift || usage

res = ""
doc = Hpricot(File.open(input))
doc.search("//form").each do |form|
  # Extract the form
  res = "<form"
  form.attributes.each do |attr|
    res << " #{attr[0]}='#{attr[1].delete("'")}'"
  end
  res << "> "

  # Strip out the value
  form.search("//input") do |inp|
    inp.attributes.keys.each do |ikey|
      if ikey.casecmp("value").zero?
        inp[ikey] = ""
        next
      end

      if inp.attributes[ikey] =~ /^http/i
        inp[ikey] = ""
        next
      end
    end

    res << inp.to_html
  end
  res << "</form>"
end

$stdout.puts res
